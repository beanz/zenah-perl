











<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head>
  <title>Zen Automated Home</title>
  <style type="text/css">
html {
    height: 100%;
}

body { 
    background-color: #ffffff;
    color: #484848;
    margin: 0px;
    padding: 0px;
    height: 100%;
}

#logo {
    float: right;
}

#header {
    background-color: #efefef;
}

#footer {
    background-color: #efefef;
    text-align: center;
    border-top: 1px solid #aa1914;
    bottom: 0;
    left: 0px;
    width: 100%;
    padding: 4px;
}

#content {
    padding: 10px;
}

h1.title {
    padding: 0.1em;
    margin: 0em;
    font: Ariel;
    color: #12171c;
}

.message {
    color: #66AA66;
}

.error {
    color: #CC4444;
}

table.view-table {
    border-collapse: collapse;
    border: 2px solid black;
}
th.view-table {
    border: 1px solid black;
    text-align: left;
}
td.view-table {
    border: 1px solid black;
}

table.list-table {
    border-collapse: collapse;
    border: 2px solid black;
}
th.list-table {
    border: 1px solid black;
}
td.list-table {
    border: 1px solid black;
}
tr.list-row-0 {
    background-color: #efefef;
}
tr.list-row-1 {
    background-color: #ffffff;
}

#nav {
    padding: 2px 0px;
    border-bottom: 5px solid #12171c;
    background-color: #efefef;
}

.navbutton-current {
    border-style: hidden;
    padding: 3px 3px 2px 3px;
    border-color: #12171c;
    background: #12171c;
}

.navbutton {
    border-bottom: 1px solid #efefef;
    padding: 3px 3px 1px 3px;
    background: #4ca7ab;
}

.navbutton-current A {
    color: #ffffff;
    font-weight: bold;
    text-decoration: none;
} 

.navbutton-current A:hover {
    color: #ffffff;
    font-weight: bold;
    text-decoration: none;
} 

.navbutton-current img {
    border-style: hidden;
}

.navbutton A {
    color: #000000;
    font-weight: bold;
    text-decoration: none;
} 

.navbutton A:hover {
    background: #cceeee;
} 

.navbutton img {
    border-style: hidden;
}


.pagebutton-current {
    border-style: hidden;
    padding: 2px 2px 2px 2px;
    border-color: #484848;
    background: #cceeee;
}

.pagebutton {
    border-style: hidden;
    padding: 2px 2px 2px 2px;
    border-color: #484848;
    background: #cccccc;
}

.pagebutton A {
    color: #000000;
    font-weight: bold;
    text-decoration: none;
} 

.pagebutton A:hover {
    background: #cceeee;
} 

.pagebutton img {
    border-style: hidden;
}

.filterbutton-current {
    border-style: hidden;
    padding: 2px 2px 2px 2px;
    border-color: #484848;
    background: #cceeee;
}

.filterbutton {
    border-style: hidden;
    padding: 2px 2px 2px 2px;
    border-color: #484848;
    background: #4ca7ab;
}

.filterbutton A {
    color: #000000;
    font-weight: bold;
    text-decoration: none;
} 

.filterbutton A:hover {
    background: #cceeee;
} 

.filterbutton img {
    border-style: hidden;
}

.crudbutton-current {
    border-style: hidden;
    padding: 2px 2px 2px 2px;
    border-color: #484848;
    background: #cceeee;
}

.crudbutton {
    border-style: hidden;
    padding: 2px 2px 2px 2px;
    border-color: #484848;
    background: #4ca7ab;
}

.crudbutton A {
    color: #000000;
    font-weight: bold;
    text-decoration: none;
} 

.crudbutton A:hover {
    background: #cceeee;
} 

.crudbutton img {
    border-style: hidden;
}


  </style>
 </head>
 <body>
<div id="header"><!-- BEGIN site/header -->
<img id="logo" class="logo" height="50" width="50" src="http://localhost/images/zenah-50.png" />
<h1 class="title">Zen Automated Home</h1>
<!-- END site/header -->
</div>
<div id="nav"><!-- BEGIN site/nav -->

  <span class="navbutton"><a
    href="http://localhost//admin/device"
    >Device</a></span>


  <span class="navbutton"><a
    href="http://localhost//admin/map"
    >Map</a></span>


  <span class="navbutton"><a
    href="http://localhost//admin/room"
    >Room</a></span>


  <span class="navbutton"><a
    href="http://localhost//admin/rule"
    >Rule</a></span>


  <span class="navbutton"><a
    href="http://localhost//admin/state"
    >State</a></span>


  <span class="navbutton"><a
    href="http://localhost//admin/template"
    >Template</a></span>

  <span class="navbutton"><a href="http://localhost/"
    >UI</a></span>
<!-- END site/nav -->
</div>

<div id="content">


<p class="filternav" id="filternav">
Filter:

  
    <span class="filterbutton-current">none</span>
  

  
    <span class="filterbutton"><a
      href="http://localhost/admin/rule/.?filter=at"
       >at</a></span>
  

  
    <span class="filterbutton"><a
      href="http://localhost/admin/rule/.?filter=scene"
       >scene</a></span>
  

  
    <span class="filterbutton"><a
      href="http://localhost/admin/rule/.?filter=xpl"
       >xpl</a></span>
  

</p>






<p class="pagenav" id="pagenav">
Page:
  
    <span class="pagebutton">&lt;&lt;</span>
  
&nbsp;

  
  
    
      <span class="pagebutton-current">1</span>
    
    &nbsp;
    
  
    
    <span class="pagebutton"><a
      href="http://localhost/admin/rule/.?page=2&filter="
        >2</a></span>
    
    &nbsp;
    
  

  
    <span class="pagebutton"><a
      href="http://localhost/admin/rule/.?page=2&filter="
        >&gt;&gt;</a></span>
  
</p>


<table class="list-table">
  <tr class="list-header">
  
    <th>name</th>
  
    <th>active</th>
  
    <th>trig_type</th>
  
    <th>trig</th>
  
    <th>action</th>
  
    <th>ftime</th>
  
    <th>mtime</th>
  
    <th>&nbsp;<!-- buttons --></th>
  </tr>
  
  
    <tr class="list-row-0">
    
      
        <td>all_windows</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>scene</td>
      
    
      
        <td><small></small></td>
      
    
      
        <td><small># map 'on' => 'open' and 'off' to 'close'
[% SET action = state == 'on' ? 'open' : (state == 'off' ? 'close' : state) %]
[% FOREACH dev = zenah.device.by_type_list("Curtain") %]
  [% dev.action("curtain/$action") %]
[% END %]
[% FOREACH dev = zenah.device.by_type_list("Blind") %]
  # Power supply can only serve 3 blinds at once so we pause a little
  [% IF loop.count AND ( loop.count % 3 ) == 0 %]
    sleep 30
  [% END %]
  [% dev.action("blind/$action") %]
  # could be written:
  # device [% dev.name %] blind/[% action %]
[% END %]
</small></td>
      
    
      
        <td>2007-08-10 20:17:45</td>
      
    
      
        <td>2007-08-05 20:30:42</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/5"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/5"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/5"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-1">
    
      
        <td>cleaner_prep</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>at</td>
      
    
      
        <td><small>recurrence freq=weekly hours=11 minutes=30 days=th</small></td>
      
    
      
        <td><small>scene all_windows state=on
# device washing_machine on</small></td>
      
    
      
        <td></td>
      
    
      
        <td>2007-08-05 19:55:54</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/9"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/9"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/9"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-0">
    
      
        <td>cuckoo</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>at</td>
      
    
      
        <td><small>recurrence freq=hourly minutes="[0,15,30,45]"</small></td>
      
    
      
        <td><small>xpl -c osd.basic command=clear text="It is [% zenah.datetime.strftime("%H:%M") %]" delay=10
</small></td>
      
    
      
        <td>2007-08-10 21:45:02</td>
      
    
      
        <td>2007-08-05 14:52:24</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/1"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/1"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/1"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-1">
    
      
        <td>dusk</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>at</td>
      
    
      
        <td><small>sunset minutes="-20"</small></td>
      
    
      
        <td><small>scene all_windows state=close
</small></td>
      
    
      
        <td>2007-08-10 20:17:44</td>
      
    
      
        <td>2007-08-03 13:53:05</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/4"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/4"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/4"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-0">
    
      
        <td>kettle</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>scene</td>
      
    
      
        <td><small></small></td>
      
    
      
        <td><small>[% zenah.device.by_name('kettle').action("x10/$state") %]
[% IF state == 'on' %]
enable kettle_warn
[% ELSE %]
disable kettle_warn
[% END %]
</small></td>
      
    
      
        <td>2007-08-05 14:54:23</td>
      
    
      
        <td>2007-08-03 15:10:21</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/6"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/6"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/6"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-1">
    
      
        <td>kettle_warn</td>
      
    
      
        <td>disabled</td>
      
    
      
        <td>at</td>
      
    
      
        <td><small>30</small></td>
      
    
      
        <td><small>xpl -c osd.basic command=clear row=3 text="Kettle is on" delay=5
</small></td>
      
    
      
        <td></td>
      
    
      
        <td>2007-08-05 14:54:23</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/8"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/8"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/8"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-0">
    
      
        <td>light_state</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>xpl</td>
      
    
      
        <td><small>message_type="xpl-trig" class="x10.basic" command=(on|off)</small></td>
      
    
      
        <td><small>[% SET dev = zenah.device.by_attr('unit', xpl.device) %]
[% IF dev and dev.type == 'X10Light' %]
  [% SET t = zenah.datetime.epoch %]
  [% FOREACH room = dev.rooms %]
    [% SET var = room.name %]
    [% SET value = xpl.command == 'on' ? 'dark' : 'light' %]
    [% CALL zenah.state.set('light', var, value) %]
  [% END %]
[% END %]</small></td>
      
    
      
        <td>2007-08-05 15:05:34</td>
      
    
      
        <td>2007-08-04 10:14:30</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/11"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/11"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/11"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-1">
    
      
        <td>motion_check</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>at</td>
      
    
      
        <td><small>recurrence freq=minutely seconds=17</small></td>
      
    
      
        <td><small>[% SET t = zenah.datetime.epoch %]
[% FOREACH room = zenah.room.all %]
  [% SET timeout = room.attribute('motion_timeout') %]
  [% NEXT UNLESS timeout %]
  [% SET cutoff = t - timeout %]
  [% SET motion = zenah.state.get('motion', room.name) %]
  [% NEXT UNLESS motion %]
  [% NEXT UNLESS motion.value == 'occupied' %]
  [% NEXT UNLESS motion.mtime.epoch < cutoff %]
  scene motion_trigger state=off room="[% room.name %]"
  [% CALL zenah.state.set('motion', room.name, 'empty') %]
[% END %]

</small></td>
      
    
      
        <td>2007-08-10 21:58:24</td>
      
    
      
        <td>2007-08-04 10:11:00</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/13"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/13"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/13"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-0">
    
      
        <td>motion_state</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>xpl</td>
      
    
      
        <td><small>message_type="xpl-trig" class="x10.basic" command=on</small></td>
      
    
      
        <td><small>[% SET dev = zenah.device.by_attr('unit', xpl.device) %]
[% IF dev and dev.type == 'X10Motion' %]
  [% SET t = zenah.datetime.epoch %]
  [% FOREACH room = dev.rooms %]
    [% CALL zenah.state.set('motion', room.name, 'occupied') %]
    scene motion_trigger state=on room="[% room.name %]"
  [% END %]
[% END %]
</small></td>
      
    
      
        <td>2007-08-05 15:05:34</td>
      
    
      
        <td>2007-08-04 10:06:30</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/10"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/10"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/10"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
    <tr class="list-row-1">
    
      
        <td>motion_trigger</td>
      
    
      
        <td>enabled</td>
      
    
      
        <td>scene</td>
      
    
      
        <td><small></small></td>
      
    
      
        <td><small>[%# trigger regardless of light state %]
[% SET lamp_name = zenah.map.lookup('motion_trigger',room) %]
debug [% lamp_name %] in [% room %]
[% IF lamp_name %]
  [% zenah.device.by_name(lamp_name).action("x10/$state") %]
[% END %]

[%# trigger only if the room is dark %]
[% SET light = zenah.state.get('light', room) %]
[% IF light.value == 'dark' OR state == 'off' %]
  [% SET lamp_name = zenah.map.lookup('motion_dark_trigger',room) %]
  [% IF lamp_name %]
    [% zenah.device.by_name(lamp_name).action("x10/$state") %]
  [% END %]
[% END %]
</small></td>
      
    
      
        <td>1970-01-01 01:33:27</td>
      
    
      
        <td>2007-08-05 18:17:53</td>
      
    
      <td>
        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/view/12"
    >View</a></span>

        
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/edit/12"
    >Edit</a></span>

        <!-- 
  <span class="crudbutton"><a
    href="http://localhost//admin/rule/destroy/12"
    >Destroy</a></span>
 -->
      </td>
    </tr>
        
  
</table>
<hr/>

  <span class="crudbutton"><a
    href="http://localhost//admin/rule/add/"
    >Add</a></span>


</div>

<div id="footer"><!-- BEGIN site/footer -->
<div id="copyright">&copy; 2006, 2008 Mark Hindess</div>
<!-- END site/footer -->
</div>

 </body>
</html>

